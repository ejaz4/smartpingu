<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About - Smart Pingu Web</title>
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/setup.css">
</head>

<body>
    <div class="centreDiv">
        <a href="/settings.html" class="backButton"><img src="/images/chevron-left.svg" />Back</a>
        <h1>Smart Pingu</h1>
        <p style="margin-bottom: 5px;">Version 2.0 (Build 28042023_DEMO)</p>
        <p>Software updates are disabled on this demo Smart Pingu.</p>
        <p>Made with ❤️ by:</p>
        <ul>
            <li>Ejaz Ali - Software</li>
            <li>Fiona Hasib - Hardware</li>
            <li>Jamela Ali - Design</li>
        </ul>
        <br>
        <p>This demo device has the following changes from the official Smart Pingu software:</p>
        <br>
        <ul>
            <li>Network can be simulated</li>
            <li>Temperature can be manipulated ± 2°C</li>
            <li>Software updates are disabled</li>
            <li>Security services has been disabled</li>
        </ul>
        <p>If this is not a demo device, switch back to the main branch.</p>
    </div>

    <script>
        const hostname = `${window.location.protocol}//${window.location.hostname}`;

        const updateStatus = document.getElementById("updateStatus");
        const updateDiv = document.getElementById("update");
        const updateButton = document.getElementById("updateButton");
        const updateInit = document.getElementById("updateInit");

        (async () => {
            const updateAvailableReq = await fetch(`${hostname}:3000/update/check`);
            if (updateAvailableReq.status == 200) {
                const updateDetails = await updateAvailableReq.json();

                if (updateDetails.update) {
                    updateStatus.innerText = `Update available: ${updateDetails.message}`;
                    updateInit.style.display = "block";
                } else {
                    updateStatus.innerText = "You're on the most recent version!";
                    if (updateDetails.message) updateStatus.innerText = updateDetails.message
                }
            }
        })()


        function update() {
            updateStatus.innerText = "Downloading update...";
            updateInit.style.display = "none";

            fetch(`${hostname}:3000/update/download`).then(async res => {
                if (res.status == 200) {
                    updateStatus.innerText = "Restarting to apply updates...";
                    setInterval(() => {
                        fetch(`${hostname}:3000/settings`).then((req) => {
                            if (req.status == 200) {
                                window.location.href = "/about.html";
                            }
                        })
                    }, 5000)
                } else {
                    updateStatus.innerText = "Update failed to download!";
                    updateInit.style.display = "block";
                }
            })
        }

        updateButton.addEventListener("click", update)
    </script>
</body>

</html>